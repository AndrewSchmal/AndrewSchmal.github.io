<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Combat Skills Planner</title>
    <script src="https://lint.page/kit/4d0fe3.js" crossorigin="anonymous"></script>

    <link rel="stylesheet" href="./styles/styles.css">
    <style>
        .character-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
            gap: 10px;
            max-height: 800px;
            overflow-y: auto;
            margin-bottom: 20px;
        }

        .character {
            text-align: center;
            cursor: pointer;
        }

        .character img {
            width: 100px;
            height: 100px;
            border-radius: 20%;
            object-fit: cover;
        }

        .core-skills-container {
            display: flex;
            flex-direction: column;
            gap: 10px;
            align-items: center;
        }

        .core-skill-row {
            display: flex;
            gap: 20px;
            justify-content: center;
        }

        .core-skill {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            width: 100px;
            height: 100px;
            background-color: #f0f0f0;
            border-radius: 8px;
            cursor: pointer;
            transition: background-color 0.3s ease, transform 0.3s ease;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }

        .core-skill img {
            width: 50px;
            height: 50px;
        }

        .materials-display {
            margin-top: 20px;
            padding: 20px;
            background-color: #f9f9f9;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            text-align: center;
        }

        .materials-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            align-items: center;
            justify-items: center;
        }

        .materials-display img {
            width: 40px;
            height: 40px;
            margin-right: 10px;
            vertical-align: middle;
        }

        .materials-display p {
            margin: 5px 0;
            font-size: 1.1rem;
        }

        .needed {
            background-color: #ffa500;
            /* Orange for "needed" */
        }

        .complete {
            background-color: #4caf50;
            /* Green for "complete" */
        }

        .material-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            padding: 10px;
            background-color: #ffffff;
            border: 2px solid #ddd;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }

        .material-item img {
            width: 50px;
            height: 50px;
            margin-bottom: 5px;
        }

        .hidden {
            display: none;
        }
        
    </style>
</head>

<body>
    <header>
        <div data-include="components/header.html"></div>
    </header>

    <main>
        <h1>Core Skills Planner</h1>
        <p>Select a character below to view their core skills:</p>
        <div class="character-grid" id="character-grid">
            <!-- Characters will dynamically load here -->
        </div>

        <div id="core-skills-section" class="hidden">
            <h2 id="selected-character-name"></h2>
            <div class="core-skills-container">
                <div class="core-skill-row">
                    <div class="core-skill" data-skill-id="A"></div>
                    <div class="core-skill" data-skill-id="C"></div>
                    <div class="core-skill" data-skill-id="E"></div>
                </div>
                <div class="core-skill-row">
                    <div class="core-skill" data-skill-id="B"></div>
                    <div class="core-skill" data-skill-id="D"></div>
                    <div class="core-skill" data-skill-id="F"></div>
                </div>
            </div>
        </div>

        <div id="materials-display" class="materials-display hidden">
            <h3>Required Materials</h3>
            <div class="materials-grid" id="materials-grid">
                <!-- Materials will dynamically load here -->
            </div>
            <div id="energy-summary">
                <h4>Energy Summary</h4>
                <p id="total-energy"></p>
                <p id="days-to-complete"></p>
                <div id="battery-display"></div>
            </div>
        </div>
        
    </main>

    <footer>
        <div data-include="components/footer.html"></div>
    </footer>
    <script>
        const coreSkills = [
            { id: 'A', name: 'Core Skill A', image: 'images/Icon_Core_Skill_A.png', materials: { dennies: 5000 } },
            { id: 'B', name: 'Core Skill B', image: 'images/Icon_Core_Skill_B.png', materials: { dennies: 12000, expertChallengeItems: 2 } },
            { id: 'C', name: 'Core Skill C', image: 'images/Icon_Core_Skill_C.png', materials: { dennies: 28000, expertChallengeItems: 4 } },
            { id: 'D', name: 'Core Skill D', image: 'images/Icon_Core_Skill_D.png', materials: { dennies: 60000, expertChallengeItems: 9, notoriousHuntItems: 2 } },
            { id: 'E', name: 'Core Skill E', image: 'images/Icon_Core_Skill_E.png', materials: { dennies: 100000, expertChallengeItems: 15, notoriousHuntItems: 3 } },
            { id: 'F', name: 'Core Skill F', image: 'images/Icon_Core_Skill_F.png', materials: { dennies: 200000, expertChallengeItems: 30, notoriousHuntItems: 4 } }
        ];

        const characterData = {
            Anby: { name: 'Anby', image: 'images/anby.png', notoriousHuntMaterial: 'Ferocious Grip', expertChallengeMaterial: 'Murderous Obituary' },
            Billy: { name: 'Billy', image: 'images/billy.png', notoriousHuntMaterial: 'Ferocious Grip', expertChallengeMaterial: 'Ethereal Pursuit' },
            Ellen: { name: 'Ellen', image: 'images/ellen.png', notoriousHuntMaterial: 'Ferocious Grip', expertChallengeMaterial: 'Murderous Obituary' },
            Jane: { name: 'Jane', image: 'images/jane.png', notoriousHuntMaterial: 'Ferocious Grip', expertChallengeMaterial: 'Falling Fist' },
            Lucy: { name: 'Lucy', image: 'images/lucy.png', notoriousHuntMaterial: 'Ferocious Grip', expertChallengeMaterial: 'Steel Malice' },
            Nekomata: { name: 'Nekomata', image: 'images/nekomata.png', notoriousHuntMaterial: 'Ferocious Grip', expertChallengeMaterial: 'Crimson Awe' },
            Nicole: { name: 'Nicole', image: 'images/nicole.png', notoriousHuntMaterial: 'Ferocious Grip', expertChallengeMaterial: 'Murderous Obituary' },
            Anton: { name: 'Anton', image: 'images/anton.png', notoriousHuntMaterial: 'Living Drive', expertChallengeMaterial: 'Destructive Advance' },
            Ben: { name: 'Ben', image: 'images/ben.png', notoriousHuntMaterial: 'Living Drive', expertChallengeMaterial: 'Steel Malice' },
            Grace: { name: 'Grace', image: 'images/grace.png', notoriousHuntMaterial: 'Living Drive', expertChallengeMaterial: 'Destructive Advance' },
            Koleda: { name: 'Koleda', image: 'images/koleda.png', notoriousHuntMaterial: 'Living Drive', expertChallengeMaterial: 'Steel Malice' },
            Qingyi: { name: 'Qingyi', image: 'images/qingyi.png', notoriousHuntMaterial: 'Living Drive', expertChallengeMaterial: 'Ethereal Pursuit' },
            Seth: { name: 'Seth', image: 'images/seth.png', notoriousHuntMaterial: 'Living Drive', expertChallengeMaterial: 'Falling Fist' },
            Yanagi: { name: 'Yanagi', image: 'images/yanagi.png', notoriousHuntMaterial: 'Living Drive', expertChallengeMaterial: 'Destructive Advance' },
            ZhuYuan: { name: 'Zhu Yuan', image: 'images/zhuyuan.png', notoriousHuntMaterial: 'Living Drive', expertChallengeMaterial: 'Ethereal Pursuit' },
            Rina: { name: 'Rina', image: 'images/rina.png', notoriousHuntMaterial: 'Finale Dance Shoes', expertChallengeMaterial: 'Destructive Advance' },
            Corin: { name: 'Corin', image: 'images/corin.png', notoriousHuntMaterial: 'Finale Dance Shoes', expertChallengeMaterial: 'Crimson Awe' },
            Piper: { name: 'Piper', image: 'images/piper.png', notoriousHuntMaterial: 'Finale Dance Shoes', expertChallengeMaterial: 'Crimson Awe' },
            Soldier11: { name: 'Soldier 11', image: 'images/soldier11.png', notoriousHuntMaterial: 'Finale Dance Shoes', expertChallengeMaterial: 'Destructive Advance' },
            Soukaku: { name: 'Soukaku', image: 'images/soukaku.png', notoriousHuntMaterial: 'Finale Dance Shoes', expertChallengeMaterial: 'Murderous Obituary' },
            Lycaon: { name: 'Lycaon', image: 'images/lycaon.png', notoriousHuntMaterial: 'Finale Dance Shoes', expertChallengeMaterial: 'Ethereal Pursuit' },
            Caesar: { name: 'Caesar', image: 'images/caesar.png', notoriousHuntMaterial: 'Scarlet Engine', expertChallengeMaterial: 'Stealth Phantom' },
            Burnice: { name: 'Burnice', image: 'images/burnice.png', notoriousHuntMaterial: 'Scarlet Engine', expertChallengeMaterial: 'Stealth Phantom' },
            Lighter: { name: 'Lighter', image: 'images/lighter.png', notoriousHuntMaterial: 'Scarlet Engine', expertChallengeMaterial: 'Crimson Awe' }
        };


        let selectedSkills = new Map();


        const calculateMaterials = () => {
            const materialsGrid = document.getElementById("materials-grid");
            const energySummary = document.getElementById("energy-summary");
            const totalEnergy = document.getElementById("total-energy");
            const daysToComplete = document.getElementById("days-to-complete");
            const batteryDisplay = document.getElementById("battery-display");

            materialsGrid.innerHTML = "";
            batteryDisplay.innerHTML = "";

            let materials = {};
            let totalEnergyCost = 0;

            selectedSkills.forEach((state, skillId) => {
                if (state === "needed") {
                    const skill = coreSkills.find((s) => s.id === skillId);
                    for (let [material, amount] of Object.entries(skill.materials)) {
                        if (!materials[material]) materials[material] = 0;
                        materials[material] += amount;
                    }
                }
            });

            for (let [material, amount] of Object.entries(materials)) {
                const materialDiv = document.createElement("div");
                materialDiv.classList.add("material-item");
                materialDiv.innerHTML = `
                    <img src="images/Item_${material.replace(/ /g, "_")}.png" alt="${material}" title="${material}">
                    <span>${amount}</span>
                `;
                materialsGrid.appendChild(materialDiv);

                if (material.includes("Notorious")) totalEnergyCost += amount * 60;
                if (material.includes("Expert")) totalEnergyCost += amount * 40;
            }

            const batteryCount = Math.ceil((totalEnergyCost - 320) / 60);
            totalEnergy.textContent = `Total Energy Required: ${totalEnergyCost}`;
            daysToComplete.textContent = `Approximate Days to Complete: ${Math.ceil(totalEnergyCost / 320)}`;
            for (let i = 0; i < batteryCount; i++) {
                const batteryDiv = document.createElement("img");
                batteryDiv.src = "images/Item_Ether_Battery.png";
                batteryDiv.alt = "Ether Battery";
                batteryDiv.title = "Ether Battery (60 Energy)";
                batteryDisplay.appendChild(batteryDiv);
            }

            document.getElementById("materials-display").classList.remove("hidden");
        };

        const updateSkillStates = (skillId, newState) => {
            const index = coreSkills.findIndex((skill) => skill.id === skillId);

            if (newState === "needed") {
                for (let i = 0; i <= index; i++) {
                    selectedSkills.set(coreSkills[i].id, "needed");
                    document.querySelector(`[data-skill-id='${coreSkills[i].id}']`).classList.add("needed");
                    document.querySelector(`[data-skill-id='${coreSkills[i].id}']`).classList.remove("complete");
                }
            } else if (newState === "complete") {
                for (let i = 0; i <= index; i++) {
                    selectedSkills.set(coreSkills[i].id, "complete");
                    document.querySelector(`[data-skill-id='${coreSkills[i].id}']`).classList.add("complete");
                    document.querySelector(`[data-skill-id='${coreSkills[i].id}']`).classList.remove("needed");
                }
            } else {
                for (let i = index; i < coreSkills.length; i++) {
                    selectedSkills.set(coreSkills[i].id, "not set");
                    document.querySelector(`[data-skill-id='${coreSkills[i].id}']`).classList.remove("needed", "complete");
                }
            }

            calculateMaterials();
        };

        const toggleSkill = (skillId) => {
            const currentState = selectedSkills.get(skillId) || "not set";

            if (currentState === "not set") {
                updateSkillStates(skillId, "needed");
            } else if (currentState === "needed") {
                updateSkillStates(skillId, "complete");
            } else {
                updateSkillStates(skillId, "not set");
            }
        };

        

        const selectCharacter = (characterName) => {
            const character = characterData[characterName];
            document.getElementById("selected-character-name").innerText = `${character.name}'s Core Skills`;
            document.getElementById("core-skills-section").classList.remove("hidden");

            const coreSkillsContainer = document.querySelector(".core-skills-container");
            coreSkillsContainer.innerHTML = "";

            coreSkills.forEach((skill) => {
                const skillDiv = document.createElement("div");
                skillDiv.classList.add("core-skill");
                skillDiv.dataset.skillId = skill.id;
                skillDiv.innerHTML = `<img src="${skill.image}" alt="${skill.name}" title="${skill.name}">`;
                skillDiv.addEventListener("click", () => toggleSkill(skill.id));
                skillDiv.addEventListener("dblclick", () => updateSkillStates(skill.id, "not set"));
                coreSkillsContainer.appendChild(skillDiv);
            });
        };

        const loadCharacters = () => {
            const characterGrid = document.getElementById("character-grid");
            characterGrid.innerHTML = "";

            for (const char in characterData) {
                const character = characterData[char];
                const charDiv = document.createElement("div");
                charDiv.classList.add("character");
                charDiv.dataset.character = char;
                charDiv.innerHTML = `<img src="${character.image}" alt="${character.name}" title="${character.name}">`;
                charDiv.addEventListener("click", () => selectCharacter(char));
                characterGrid.appendChild(charDiv);
            }
        };

        document.addEventListener("DOMContentLoaded", loadCharacters);
    </script>
    <script src="../scripts/HTMLInclude.min.js"></script>
</body>

</html>